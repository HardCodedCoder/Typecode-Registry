<div class="outer-container">
  <div class="table-container">
    <div class="table-menu">
      <form [formGroup]="searchForm" tuiTextfieldIcon="tuiIconSearchLarge">
        <tui-input label="Search" formControlName="search" [tuiTextfieldCleaner]="true" tuiTextfieldSize="m">
          Search
          <input tuiTextfield />
        </tui-input>
      </form>
      <button appearance="destructive" icon="tuiIconFilterLarge" tuiIconButton type="button"
        [attr.aria-hidden]="true"></button>
      <button appearance="accent" icon="tuiIconPlusLarge" tuiIconButton type="button" (click)="showDialog()"
        [attr.aria-hidden]="true"></button>
    </div>

    <tui-scrollbar *ngIf="this.storeService.allExtensions; else noData" class="border-radius">
      <table tuiTable [columns]="columns">
        <thead>
          <tr tuiThGroup>
            <th *tuiHead="'Name'" tuiTh>Name</th>
            <th *tuiHead="'Description'" tuiTh>Description</th>
            <th *tuiHead="'Project'" tuiTh>Project</th>
            <th *tuiHead="'Scope'" tuiTh>Scope</th>
            <th *tuiHead="'Item Count'" tuiTh>Number of Items</th>
            <th *tuiHead="'Creation Date'" tuiTh>Creation Date</th>
            <th *tuiHead="'Actions'" tuiTh [sorter]="null">Actions</th>
          </tr>
        </thead>

        <tbody *tuiLet="
            this.storeService.allExtensions | tuiTableSort as sortedExtensions
          " tuiTbody [data]="sortedExtensions">
          <tr *ngFor="let extension of sortedExtensions" tuiTr>
            <td *tuiCell="'Name'" tuiTd>{{ extension.name }}</td>
            <td *tuiCell="'Description'" tuiTd>
              <tui-elastic-container class="text-align-start font-size-09">
                <!-- conditional rendering based on set membership and description length -->
                {{ expandedItemIds.has(extension.id) || extension.description.length <= MAX_DESCRIPTION_LENGTH ?
                  extension.description : (extension.description | slice:0:MAX_DESCRIPTION_LENGTH) + '...' }} <!-- show
                  button only if description is longer than MAX_DESCRIPTION_LENGTH -->
                  <button *ngIf="extension.description.length > MAX_DESCRIPTION_LENGTH" tuiLink
                    (click)="toggle(extension.id)"
                    [attr.aria-expanded]="expandedItemIds.has(extension.id) ? 'true' : 'false'">
                    Show {{ expandedItemIds.has(extension.id) ? 'less' : 'more' }}
                  </button>
              </tui-elastic-container>
            </td>
            <td *tuiCell="'Project'" tuiTd>
              {{ getProjectName(extension.project_id) ?? '-' }}
            </td>
            <td *tuiCell="'Scope'" tuiTd>
              <tui-tag class="tui-space_right-1" [autoColor]="true" [value]="extension.scope"></tui-tag>
            </td>
            <td *tuiCell="'Item Count'" tuiTd>
              {{ extension.item_count ?? 0 }}
            </td>
            <td *tuiCell="'Creation Date'" tuiTd>
              <span>{{ extension.creation_date | date: 'fullDate' }} </span>
              <br>
              <span class="no-wrap">{{ extension.creation_date | date: 'shortTime' }}</span>
            </td>
            <td *tuiCell="'Actions'" tuiTd>Button</td>
          </tr>
        </tbody>
      </table>
    </tui-scrollbar>

    <ng-template #noData>
      <h1>No extensions available.</h1>
    </ng-template>
  </div>

  <div class="item-cards"></div>
</div>